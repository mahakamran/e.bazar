<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>E.BAZAR ‚Äî Admin Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{--bg:#f6f7fb;--card:#fff;--muted:#687182;--accent:#FFD700;--dark:#0b1220}
    *{box-sizing:border-box}
    body{font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:var(--bg);color:var(--dark)}
    .app{display:flex;min-height:100vh}

    /* Sidebar */
    .sidebar{width:260px;background:#0f1724;color:#fff;padding:22px 18px;display:flex;flex-direction:column;gap:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:44px;height:44px;border-radius:8px;object-fit:cover}
    .brand .title{font-weight:700;font-size:18px}
    .nav{margin-top:6px;display:flex;flex-direction:column;gap:8px}
    .nav a{color:#c9d2df;text-decoration:none;padding:10px;border-radius:8px;display:flex;align-items:center;gap:10px}
    .nav a.active, .nav a:hover{background:rgba(255,215,0,0.12);color:var(--accent)}
    .nav a .icon{width:18px;text-align:center}
    .sidebar .small{font-size:12px;color:#9aa6b8}

    /* Main */
    .main{flex:1;padding:20px 28px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:20px}
    .search{flex:1;max-width:520px;display:flex;gap:8px}
    .search input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #e6e9ee}
    .top-actions{display:flex;align-items:center;gap:12px}
    .icon-btn{background:var(--card);padding:8px;border-radius:10px;border:1px solid #e6e9ee}

    /* Cards */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(11,17,32,0.04)}
    .col-3{grid-column:span 3}
    .col-6{grid-column:span 6}
    .col-8{grid-column:span 8}
    .col-4{grid-column:span 4}
    .kpi{display:flex;flex-direction:column;gap:8px}
    .kpi .num{font-size:20px;font-weight:700}
    .kpi .label{color:var(--muted);font-size:13px}

    /* Charts */
    .chart-wrap{height:220px}

    /* Orders */
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px 10px;text-align:left;border-bottom:1px solid #f0f2f6}
    th{font-size:13px;color:var(--muted)}
    td .badge{padding:6px 8px;border-radius:8px;font-weight:600;font-size:13px}
    .badge.paid{background:rgba(40,167,69,0.12);color:#28a745}
    .badge.pending{background:rgba(255,193,7,0.12);color:#c47f00}

    /* ================= MOBILE MENU ================= */
    .menu-toggle{
      display:none;
      background:none;
      border:none;
      font-size:24px;
      color:#000;
      cursor:pointer;
    }

    .close-menu{
      display:none;
      background:none;
      border:none;
      font-size:22px;
      color:#fff;
      cursor:pointer;
      align-self:flex-end;
    }

    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.45);
      display:none;
      z-index:998;
    }
    .overlay.show{display:block;}

    @media (max-width:1000px){
      .col-3{grid-column:span 6}
      .col-6{grid-column:span 12}
      .col-4{grid-column:span 6}
      .col-8{grid-column:span 12}
      .sidebar{display:none}
      .topbar{flex-direction:column;align-items:flex-start}
    }

    @media (max-width:650px){
      .menu-toggle{display:block;}

      .sidebar{
        display:flex;
        position:fixed;
        top:0;
        left:-280px;
        height:100vh;
        width:260px;
        z-index:999;
        transition:.3s ease;
      }

      .sidebar.show{left:0;}

      .close-menu{display:block;}

      .grid{grid-template-columns:1fr;}
      .main{padding:14px 10px;}
    }
    /* =============================
   FIX HORIZONTAL SCROLL PROBLEM
   (NO DESIGN CHANGE)
============================= */

*{
  max-width:100%;
}

body{
  overflow-x:hidden;
}

/* Force cards to stay inside screen */
.grid{
  width:100%;
  max-width:100%;
  overflow:hidden;
}

/* Make cards flexible */
.card{
  min-width:0;
  width:100%;
}

/* Charts should never push layout */
.chart-wrap{
  max-width:100%;
  overflow:hidden;
}

/* Fix tables overflow only inside card */
.card table{
  width:100%;
  min-width:0;
  table-layout:fixed;
}

.card table th,
.card table td{
  word-break:break-word;
  white-space:normal;
}


/* RESPONSIVE GRID CORRECTION */
@media (max-width:1000px){
  .col-3,.col-4,.col-6,.col-8{
    grid-column:span 12 !important;
  }
}

@media (max-width:650px){
  .grid{
    grid-template-columns:1fr !important;
  }
}

  </style>
</head>

<body>

<div class="app">
  
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <button class="close-menu" id="closeSidebar">‚úñ</button>

    <a class="brand" href="#">
      <img src="/image/pic11.png"  alt="logo" / style="background-color: white;">
      <div>
        <div class="title">E.BAZAR Admin</div>
        <div class="small">manage products & orders</div>
      </div>
    </a>

    <nav class="nav">
      <a href="/admin/dashboard" class="active"><span class="icon">üè†</span> Dashboard</a>
      <a href="/admin/products"><span class="icon">üì¶</span> Products</a>
      <a href="/admin/add-product"><span class="icon">‚ûï</span> Add Product</a>
      <a href="/admin/orders"><span class="icon">üßæ</span> Orders</a>
      <a href="/admin/users"><span class="icon">üë•</span> Users</a>
      <a href="/admin/categories"><span class="icon">üìÇ</span> Categories</a>
      <a href="/admin/settings"><span class="icon">‚öôÔ∏è</span> Settings</a>
    </nav>

    <div style="margin-top:auto;font-size:13px;color:#9aa6b8;">
      Logged in as <strong><%= user.fullName %></strong><br>
      <a href="/logout" style="color:#FFD700;text-decoration:none">Logout</a>
    </div>
  </aside>

  <!-- Overlay -->
  <div class="overlay" id="overlay"></div>

  <!-- MAIN -->
  <main class="main">

    <!-- TOPBAR -->
    <div class="topbar">
      <button id="menuBtn" class="menu-toggle">‚ò∞</button>

      <div style="display:flex;align-items:center;gap:14px;flex:1">
        <div class="search"><input placeholder="Search products, orders, users..." /></div>
        <div class="top-actions">
          <div class="icon-btn">üîî</div>
          <div class="icon-btn">üí¨</div>
        </div>
      </div>

      <div style="display:flex;gap:12px;align-items:center">
        <div style="text-align:right">
          <div style="font-size:12px;color:var(--muted)">Today</div>
          <div style="font-weight:700">Nov 2025</div>
        </div>
      </div>
    </div>

     <!-- DASHBOARD -->
    <section class="grid">

      <div class="card col-3 kpi">
        <div class="label">Total Sales</div>
        <div class="num">$<%= salesAmount.toFixed(2) %></div>
        <div style="color:var(--muted);font-size:13px">+8.4% vs last week</div>
      </div>

      <div class="card col-3 kpi">
        <div class="label">Orders</div>
        <div class="num"><%= totalOrders %></div>
        <div style="color:var(--muted);font-size:13px">12 new today</div>
      </div>

      <div class="card col-3 kpi">
        <div class="label">Products</div>
        <div class="num"><%= totalProducts %></div>
        <div style="color:var(--muted);font-size:13px">45 low stock</div>
      </div>

      <div class="card col-3 kpi">
        <div class="label">Customers</div>
       <div class="num"><%= totalUsers %></div>
        <div style="color:var(--muted);font-size:13px">320 new</div>
      </div>

      <div class="card col-8">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Sales (Last 7 days)</strong>
          <small style="color:var(--muted)">Revenue</small>
        </div>
        <div class="chart-wrap"><canvas id="salesChart"></canvas></div>
      </div>

      <div class="card col-4">
        <strong>Top Categories</strong>
        <div class="chart-wrap"><canvas id="catChart"></canvas></div>
      </div>

      <div class="card col-6">
        <strong>Recent Orders</strong>
        <table>
          <thead>
            <tr><th>Order</th><th>Customer</th><th>Amount</th><th>Status</th></tr>
          </thead>
          <tbody id="ordersT">
  <% recentOrders.forEach(o => { %>
    <tr>
      <td>#<%= o._id.toString().slice(-6) %></td>
      <td><%= o.user?.fullName || o.name || "Guest" %></td>
      <td>$<%= o.totalAmount.toFixed(2) %></td>
      <td>
        <span class="badge <%= o.status === 'Completed' ? 'paid' : 'pending' %>">
          <%= o.status %>
        </span>
      </td>
    </tr>
  <% }) %>
</tbody>


        </table>
      </div>

      <div class="card col-6">
       <strong>Top Selling Products</strong>

       <table>
  <thead>
    <tr>
      <th>Product</th>
      <th>Sold</th>
      <th>Revenue</th>
    </tr>
  </thead>

  <tbody>
    <% if(topProducts.length > 0){ %>
      <% topProducts.forEach(p => { %>
        <tr>
          <td><%= p.name %></td>
          <td><%= p.totalSold %></td>
          <td>$<%= p.revenue.toFixed(2) %></td>
        </tr>
      <% }) %>
    <% } else { %>
      <tr>
        <td colspan="3" style="text-align:center;color:#888">No sales data</td>
      </tr>
    <% } %>
  </tbody>
</table>

      </div>

    </section>

  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const salesLabels = <%- chartLabels %>;
  const salesData   = <%- chartData %>;
  const catLabels   = <%- catLabels %>;
  const catData     = <%- catData %>;

  // Line chart
  new Chart(document.getElementById('salesChart'), {
    type: 'line',
    data: {
      labels: salesLabels,
      datasets: [{
        data: salesData,
        fill: true,
        borderColor: '#FFD700',
        backgroundColor: 'rgba(255,215,0,0.15)'
      }]
    },
    options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}} }
  });

  // Doughnut chart
  new Chart(document.getElementById('catChart'), {
    type: 'doughnut',
    data: {
      labels: catLabels,
      datasets: [{ data: catData }]
    },
    options:{ responsive:true, maintainAspectRatio:false }
  });
</script>

<script>

  const ORDERS = [
    {id:1023,customer:'Sara',amount:79.99,status:'paid'},
    {id:1024,customer:'Ali',amount:42.00,status:'pending'},
    {id:1025,customer:'Noor',amount:120.00,status:'paid'},
    {id:1026,customer:'Bilal',amount:39.50,status:'pending'},
  ];


</script>
  </main>
</div>

<script>
  const menuBtn  = document.getElementById("menuBtn");
  const sidebar  = document.querySelector(".sidebar");
  const closeBtn = document.getElementById("closeSidebar");
  const overlay  = document.getElementById("overlay");

  menuBtn.onclick = () => {
    sidebar.classList.add("show");
    overlay.classList.add("show");
  };

  closeBtn.onclick = () => {
    sidebar.classList.remove("show");
    overlay.classList.remove("show");
  };

  overlay.onclick = () => {
    sidebar.classList.remove("show");
    overlay.classList.remove("show");
  };
</script>

</body>
</html>
